<!DOCTYPE html>
<html>
<head>
    <title>Conferma Prenotazione</title>
    <link rel="stylesheet" href="styles.css">
    <h2 style="text-align:center">La prenotazione Ã¨ stata effettuata con successo!</h2>
    <h3 style="text-align:center">Ecco un riepilogo dei dati relativi alla prenotazione:</h3>
</head>
<body>
    <div id="riepilogo">
        <p id="reservation-code"></p>
        <p id="titolo"></p>
        <p id="data"></p>
        <p id="orario"></p>
        <p id="sala"></p>
        <p>Posti Selezionati:</p>
        <p id="postiSelezionati"></p>
    </div>
    <script>
        //nota: le scritte del riepilogo non vengono mostrate, le sistemo poi
        const urlParams = new URLSearchParams(window.location.search);
        const reservationCode = urlParams.get('code');
        const movie = urlParams.get('movie');
        const time = urlParams.get('time');

        async function fetchBookingData() {
            try {
                // Effettua una richiesta al server per ottenere i dati della prenotazione
                const response = await fetch("http://localhost:8080/movies/reservations/" + reservationCode);

                if (!response.ok) {
                    throw new Error(`Response was not successful: ${response.status} ${response.statusText}`);
                }

                const bookingData = await response.json();
                return bookingData;
            } catch (error) {
                console.error("Errore durante il recupero dei dati della prenotazione:", error);
            }
        }

        async function showDetails(){
            const bookingData = await fetchBookingData();
            let seats = "";
            for (let i = 0; i < bookingData.seats.length; i++) {
                seats += "Posto: " + (bookingData.seats[i].column + 1) + ", Fila: " + (bookingData.seats[i].row + 1);
                if (i !== bookingData.seats.length - 1) {
                    seats += "; ";
                }
            }
            document.getElementById("postiSelezionati").innerText = seats;
           /*  const selectedSeatsElement = document.getElementById("postiSelezionati");
            selectedSeatsElement.textContent = "Posti prenotati: " + bookingData.seats.join(", "); */ //
            document.getElementById("titolo").innerText = "Titolo del film: " + bookingData.title;
            document.getElementById("data").innerText = "Data: " + bookingData.date;
            document.getElementById("orario").innerText ="Orario: " + time;
            document.getElementById("reservation-code").innerText = "Codice prenotazione: " + reservationCode;
            document.getElementById("sala").innerText = "Sala: " + bookingData.room;
        }
        // Avvia il recupero dei dati della prenotazione

        window.onload = showDetails;


        /* function getMovieTitle(movie) {
            switch (movie) {
                case '0':
                return 'Colpa delle stelle';
                case '1':
                return 'Salvate il soldato Ryan';
                case '2':
                return 'Interstellar';
                default:
                return 'Titolo Film Sconosciuto';
            }
        } */
        

    </script>
</body>
</html>